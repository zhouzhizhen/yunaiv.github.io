<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="google-site-verification" content="GkJ68PCnxM9Ih7Zm9v8p91FOCV7ymNCO2KdGbflLh3E"><meta name="360-site-verification" content="dd6547587641bfede036f7c79561e8a0"><meta name="shenma-site-verification" content="fd96cf3751972c9b05f8471d2ccadddc_1496951214"><meta name="msvalidate.01" content="1D38B05050A977F6FDEDA481198343F1"><meta name="sogou_site_verification" content="MpPsku240L"><title>Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šé…ç½® | èŠ‹è‰¿Vçš„åšå®¢</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3,minimum-scale=1"><meta name="author" content="ç‹æ–‡æ–Œ"><meta name="description" content="1. æ¦‚è¿°
2. ä½œä¸šé…ç½®

2.1 æ³¨å†Œä¸­å¿ƒé…ç½®
2.2 Liteä½œä¸šé…ç½®

2.2.1 ä½œä¸šç±»å‹é…ç½®
2.2.2 ä½œä¸šæ ¸å¿ƒé…ç½®


2.3 ä½œä¸šäº‹ä»¶é…ç½®
2.4 ä½œä¸šç›‘å¬å™¨


3. ä½œä¸šé…ç½®æœåŠ¡

3.1 è¯»å–ä½œä¸šé…ç½®
3.2 æŒä¹…åŒ–ä½œä¸šé…ç½®
3.3 æ ¡éªŒæœ¬æœºæ—¶é—´æ˜¯å¦åˆæ³•


666. å½©è›‹
"><meta name="keywords" content="Java,æ¶æ„,åç«¯,æœåŠ¡ç«¯,RocketMQ,MyCAT,åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—,åˆ†å¸ƒå¼å­˜å‚¨,æŠ€æœ¯åšå®¢,Sharding-JDBC,åˆ†åº“åˆ†è¡¨"><link rel="alternate" href="atom.xml" title="èŠ‹è‰¿Vçš„åšå®¢" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?ef4ed89f6dc83d01803a2440ae21e666";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>!function(){var t="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?f05b61dd54bbc38386611a5238672938":"https://jspassport.ssl.qhimg.com/11.0.1.js?f05b61dd54bbc38386611a5238672938";document.write('<script src="'+t+'" id="sozz"><\/script>')}()</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head></html><body><header><div><div id="textlogo"><h1 class="site-name"><a href="/" title="èŠ‹è‰¿Vçš„åšå®¢">èŠ‹è‰¿Vçš„åšå®¢</a></h1><a class="blog-motto">æ„¿ç¼–ç åŠç”Ÿï¼Œå¦‚è€å‹ç›¸ä¼´ï¼</a></div><div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•"></a></div><nav class="animated"><ul><ul><li><a href="/">æ–‡ç« </a></li><li><a href="https://github.com/YunaiV" rel="external nofollow noopener noreferrer" target="_blank">Github</a></li><li><a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">å¾®ä¿¡å…¬ä¼—å·</a></li></ul></ul></nav></div></header><div id="container"><div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div><div id="toc" class="toc-aside"><strong class="toc-title">æ–‡ç« ç›®å½•</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">2. ä½œä¸šé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 æ³¨å†Œä¸­å¿ƒé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Liteä½œä¸šé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 ä½œä¸šç±»å‹é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 ä½œä¸šæ ¸å¿ƒé…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ä½œä¸šäº‹ä»¶é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 ä½œä¸šç›‘å¬å™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">3. ä½œä¸šé…ç½®æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 è¯»å–ä½œä¸šé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 æŒä¹…åŒ–ä½œä¸šé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 æ ¡éªŒæœ¬æœºæ—¶é—´æ˜¯å¦åˆæ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">666. å½©è›‹</span></a></li></ol></div><div id="asidepart"><aside class="clearfix"><div id="authorInfo"><div><img width="100%" src="/images/common/wechat_mp_2017_07_31_bak.jpg"></div><div class="social-list"></div></div><div class="categorieslist"><p class="asidetitle">å¾®ä¿¡å…¬ä¼—å·ç¦åˆ©ï¼šèŠ‹é“æºç </p><ul><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">0. é˜…è¯»æºç è‘µèŠ±å®å…¸</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">1. RocketMQ / MyCAT / Sharding-JDBC è¯¦ç»†ä¸­æ–‡æ³¨é‡Šæºç </a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">2. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">3. æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ï¼Œæ¯å‘¨å…­åç‚¹æ›´æ–°</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">4. è®¤çœŸçš„æºç äº¤æµå¾®ä¿¡ç¾¤</a></li></ul></div><div class="categorieslist"><p class="asidetitle">åˆ†ç±»</p><ul><li><a href="/categories/Docker/" title="Docker">Docker<sup>2</sup></a></li><li><a href="/categories/Elastic-Job/" title="Elastic-Job">Elastic-Job<sup>3</sup></a></li><li><a href="/categories/MyCAT/" title="MyCAT">MyCAT<sup>9</sup></a></li><li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>1</sup></a></li><li><a href="/categories/RocketMQ/" title="RocketMQ">RocketMQ<sup>14</sup></a></li><li><a href="/categories/Sharding-JDBC/" title="Sharding-JDBC">Sharding-JDBC<sup>18</sup></a></li><li><a href="/categories/æŠ€æœ¯æ‚æ–‡/" title="æŠ€æœ¯æ‚æ–‡">æŠ€æœ¯æ‚æ–‡<sup>2</sup></a></li></ul></div></aside></div><div id="main" class="post" itemscope="" itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/Elastic-Job/job-config/" title="Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šé…ç½®" itemprop="url">Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šé…ç½®</a></h1><p class="article-author"></p><p class="article-time">æ€»é˜…è¯»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡</p></header><div class="article-content"><div id="toc" class="toc-article"><strong class="toc-title">æ–‡ç« ç›®å½•</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">2. ä½œä¸šé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 æ³¨å†Œä¸­å¿ƒé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Liteä½œä¸šé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 ä½œä¸šç±»å‹é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 ä½œä¸šæ ¸å¿ƒé…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ä½œä¸šäº‹ä»¶é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 ä½œä¸šç›‘å¬å™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">3. ä½œä¸šé…ç½®æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 è¯»å–ä½œä¸šé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 æŒä¹…åŒ–ä½œä¸šé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 æ ¡éªŒæœ¬æœºæ—¶é—´æ˜¯å¦åˆæ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">666. å½©è›‹</span></a></li></ol></div><ul><li><a href="#">1. æ¦‚è¿°</a></li><li><a href="#">2. ä½œä¸šé…ç½®</a><ul><li><a href="#">2.1 æ³¨å†Œä¸­å¿ƒé…ç½®</a></li><li><a href="#">2.2 Liteä½œä¸šé…ç½®</a><ul><li><a href="#">2.2.1 ä½œä¸šç±»å‹é…ç½®</a></li><li><a href="#">2.2.2 ä½œä¸šæ ¸å¿ƒé…ç½®</a></li></ul></li><li><a href="#">2.3 ä½œä¸šäº‹ä»¶é…ç½®</a></li><li><a href="#">2.4 ä½œä¸šç›‘å¬å™¨</a></li></ul></li><li><a href="#">3. ä½œä¸šé…ç½®æœåŠ¡</a><ul><li><a href="#">3.1 è¯»å–ä½œä¸šé…ç½®</a></li><li><a href="#">3.2 æŒä¹…åŒ–ä½œä¸šé…ç½®</a></li><li><a href="#">3.3 æ ¡éªŒæœ¬æœºæ—¶é—´æ˜¯å¦åˆæ³•</a></li></ul></li><li><a href="#">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.yunai.me/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š</p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨</li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong></li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚</li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚</li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Elastic-Job-Lite ä½œä¸šé…ç½®</strong>ã€‚</p><p>æ¶‰åŠåˆ°ä¸»è¦ç±»çš„ç±»å›¾å¦‚ä¸‹( <a href="http://www.yunai.me/images/Elastic-Job/2017_09_09/01.png">æ‰“å¼€å¤§å›¾</a> )ï¼š</p><p><img src="http://www.yunai.me/images/Elastic-Job/2017_09_09/01.png" alt=""></p><ul><li><strong>é»„è‰²</strong>çš„ç±»åœ¨ <code>elastic-job-common-core</code> é¡¹ç›®é‡Œï¼Œä¸º Elastic-Job-Liteã€Elastic-Job-Cloud <strong>å…¬ç”¨</strong>ä½œä¸šé…ç½®ç±»ã€‚</li></ul><p>å¦å¤–å»ºè®®ä½ å·²ç»( éå¿…é¡» )ï¼š</p><ul><li>é˜…è¯»è¿‡<a href="http://dangdangdotcom.github.io/elastic-job/elastic-job-lite/02-guide/config-manual/" rel="external nofollow noopener noreferrer" target="_blank">ã€Šå®˜æ–¹æ–‡æ¡£ â€”â€” é…ç½®æ‰‹å†Œã€‹</a></li><li>è¿è¡Œè¿‡ <a href="https://github.com/dangdangdotcom/elastic-job/blob/8926e94aa7c48dc635a36518da2c4b10194420a5/elastic-job-example/elastic-job-example-lite-java/src/main/java/com/dangdang/ddframe/job/example/JavaMain.java" rel="external nofollow noopener noreferrer" target="_blank">JavaMain.java</a></li></ul><blockquote><p>ä½ è¡Œå¥½äº‹ä¼šå› ä¸ºå¾—åˆ°èµèµè€Œæ„‰æ‚¦<br>åŒç†ï¼Œå¼€æºé¡¹ç›®è´¡çŒ®è€…ä¼šå› ä¸º Star è€Œæ›´åŠ æœ‰åŠ¨åŠ›<br>ä¸º Elastic-Job ç‚¹èµï¼<a href="https://github.com/dangdangdotcom/elastic-job/stargazers" rel="external nofollow noopener noreferrer" target="_blank">ä¼ é€é—¨</a></p></blockquote><h1>2. ä½œä¸šé…ç½®</h1><p>ä¸€ä¸ª<strong>ä½œä¸š( ElasticJob )<strong>çš„è°ƒåº¦ï¼Œéœ€è¦é…ç½®</strong>ç‹¬æœ‰</strong>çš„ä¸€ä¸ª<strong>ä½œä¸šè°ƒåº¦å™¨( JobScheduler )</strong>ï¼Œä¸¤è€…æ˜¯ <code>1 : 1</code> çš„å…³ç³»ã€‚<strong>è¿™ç‚¹å¤§å®¶è¦æ³¨æ„ä¸‹ï¼Œå½“ç„¶ä¸‹æ–‡çœ‹ä»£ç ä¹Ÿä¼šçœ‹åˆ°ã€‚</strong></p><p>ä½œä¸šè°ƒåº¦å™¨çš„åˆ›å»ºå¯ä»¥é…ç½®å››ä¸ªå‚æ•°ï¼š</p><ol><li>æ³¨å†Œä¸­å¿ƒ( CoordinatorRegistryCenter )ï¼šç”¨äºåè°ƒåˆ†å¸ƒå¼æœåŠ¡ã€‚<strong>å¿…å¡«</strong>ã€‚</li><li>Liteä½œä¸šé…ç½®( LiteJobConfiguration )ï¼š<strong>å¿…å¡«</strong>ã€‚</li><li>ä½œä¸šäº‹ä»¶æ€»çº¿( JobEventBus )ï¼šå¯¹ä½œä¸šäº‹ä»¶<strong>å¼‚æ­¥</strong>ç›‘å¬ã€‚<strong>é€‰å¡«</strong>ã€‚</li><li>ä½œä¸šç›‘å¬å™¨( ElasticJobListener )ï¼šå¯¹ä½œä¸šæ‰§è¡Œå‰ï¼Œæ‰§è¡Œåè¿›è¡Œ<strong>åŒæ­¥</strong>ç›‘å¬ã€‚<strong>é€‰å¡«</strong>ã€‚</li></ol><h2>2.1 æ³¨å†Œä¸­å¿ƒé…ç½®</h2><p>Elastic-Job æŠ½è±¡äº†<strong>æ³¨å†Œä¸­å¿ƒæ¥å£( RegistryCenter )</strong>ï¼Œå¹¶æä¾›äº†é»˜è®¤<strong>åŸºäº Zookeeper çš„æ³¨å†Œä¸­å¿ƒå®ç°( ZookeeperRegistryCenter )</strong>ã€‚</p><p>ZookeeperRegistryCenter å¯¹åº”é…ç½®ç±»ä¸º ZookeeperConfigurationã€‚è¯¥ç±»æ³¨é‡Šå¾ˆå®Œæˆï¼Œå¯ä»¥ç‚¹å‡»<a href="https://github.com/dangdangdotcom/elastic-job/blob/7dc099541a16de49f024fc59e46377a726be7f6b/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/reg/zookeeper/ZookeeperConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">é“¾æ¥</a>ç›´æ¥æŸ¥çœ‹æºç ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹è¯´ä¸‹ <code>namespace</code> å±æ€§ã€‚å¦‚æœä½ æœ‰å¤šä¸ª<strong>ä¸åŒ</strong> Elastic-Jobé›†ç¾¤ æ—¶ï¼Œä½¿ç”¨ç›¸åŒ Zookeeperï¼Œå¯ä»¥é…ç½®ä¸åŒçš„ <code>namespace</code> è¿›è¡Œéš”ç¦»ã€‚</p><p>æ³¨å†Œä¸­å¿ƒçš„<strong>åˆå§‹åŒ–</strong>ï¼Œæˆ‘ä»¬ä¼šåœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” æ³¨å†Œä¸­å¿ƒã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><h2>2.2 Liteä½œä¸šé…ç½®</h2><p><a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-lite/elastic-job-lite-core/src/main/java/com/dangdang/ddframe/job/lite/config/LiteJobConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">LiteJobConfiguration</a> ç»§æ‰¿è‡ªæ¥å£ <a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/config/JobRootConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">JobRootConfiguration</a>ï¼Œä½œä¸º Elastic-Job-Lite é‡Œçš„ä½œä¸š( LiteJob )é…ç½®ã€‚<em>Elastic-Job-Cloud çš„ä½œä¸š( CloudJob )å¯¹åº”å¦å¤–çš„é…ç½®ç±»ï¼Œä¹Ÿå®ç°äº†è¯¥æ¥å£ã€‚</em></p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LiteJobConfiguration</span> <span class="keyword">implements</span> <span class="title">JobRootConfiguration</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JobTypeConfiguration typeConfig;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> monitorExecution;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> maxTimeDiffSeconds;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> monitorPort;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String jobShardingStrategyClass;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> reconcileIntervalMinutes;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> disabled;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> overwrite;</div><div class="line">    </div><div class="line">    <span class="comment">// .... çœç•¥éƒ¨åˆ†getæ–¹æ³•</span></div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">    </div><div class="line">        <span class="comment">// .... çœç•¥éƒ¨åˆ†å±æ€§</span></div><div class="line">    </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> LiteJobConfiguration <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LiteJobConfiguration(jobConfig, monitorExecution, maxTimeDiffSeconds, monitorPort, jobShardingStrategyClass, reconcileIntervalMinutes, disabled, overwrite);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li><p><code>typeConfig</code>ï¼šä½œä¸šç±»å‹é…ç½®ã€‚<strong>å¿…å¡«</strong>ã€‚</p></li><li><p><code>monitorExecution</code>ï¼šç›‘æ§ä½œä¸šè¿è¡Œæ—¶çŠ¶æ€ã€‚é»˜è®¤ä¸º <code>false</code>ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šæ‰§è¡Œã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><blockquote><p>æ¯æ¬¡ä½œä¸šæ‰§è¡Œæ—¶é—´å’Œé—´éš”æ—¶é—´å‡<strong>éå¸¸çŸ­</strong>çš„æƒ…å†µï¼Œå»ºè®®ä¸ç›‘æ§ä½œä¸šè¿è¡Œæ—¶çŠ¶æ€ä»¥æå‡æ•ˆç‡ã€‚å› ä¸ºæ˜¯ç¬æ—¶çŠ¶æ€ï¼Œæ‰€ä»¥æ— å¿…è¦ç›‘æ§ã€‚è¯·ç”¨æˆ·è‡ªè¡Œå¢åŠ æ•°æ®å †ç§¯ç›‘æ§ã€‚å¹¶ä¸”ä¸èƒ½ä¿è¯æ•°æ®é‡å¤é€‰å–ï¼Œåº”åœ¨ä½œä¸šä¸­å®ç°å¹‚ç­‰æ€§ã€‚<br>æ¯æ¬¡ä½œä¸šæ‰§è¡Œæ—¶é—´å’Œé—´éš”æ—¶é—´å‡<strong>è¾ƒé•¿çš„</strong>æƒ…å†µï¼Œå»ºè®®ç›‘æ§ä½œä¸šè¿è¡Œæ—¶çŠ¶æ€ï¼Œå¯ä¿è¯æ•°æ®ä¸ä¼šé‡å¤é€‰å–ã€‚</p></blockquote></li><li><p><code>monitorPort</code>ï¼šä½œä¸šç›‘æ§ç«¯å£ã€‚é»˜è®¤ä¸º <code>-1</code>ï¼Œä¸å¼€å¯ä½œä¸šç›‘æ§ç«¯å£ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šç›‘æ§æœåŠ¡ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><blockquote><p>å»ºè®®é…ç½®ä½œä¸šç›‘æ§ç«¯å£, æ–¹ä¾¿å¼€å‘è€…dumpä½œä¸šä¿¡æ¯ã€‚<br>ä½¿ç”¨æ–¹æ³•: echo â€œdumpâ€ | nc 127.0.0.1 9888</p></blockquote></li><li><p><code>maxTimeDiffSeconds</code>ï¼šè®¾ç½®æœ€å¤§å®¹å¿çš„æœ¬æœºä¸æ³¨å†Œä¸­å¿ƒçš„æ—¶é—´è¯¯å·®ç§’æ•°ã€‚é»˜è®¤ä¸º <code>-1</code>ï¼Œä¸æ£€æŸ¥æ—¶é—´è¯¯å·®ã€‚é€‰å¡«ã€‚</p></li><li><p><code>jobShardingStrategyClass</code>ï¼šä½œä¸šåˆ†ç‰‡ç­–ç•¥å®ç°ç±»å…¨è·¯å¾„ã€‚é»˜è®¤ä¸ºä½¿ç”¨åˆ†é…ä¾§è·¯ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šåˆ†ç‰‡ç­–ç•¥ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p><code>reconcileIntervalMinutes</code>ï¼šä¿®å¤ä½œä¸šæœåŠ¡å™¨ä¸ä¸€è‡´çŠ¶æ€æœåŠ¡è°ƒåº¦é—´éš”æ—¶é—´ï¼Œé…ç½®ä¸ºå°äº1çš„ä»»æ„å€¼è¡¨ç¤ºä¸æ‰§è¡Œä¿®å¤ã€‚é»˜è®¤ä¸º <code>10</code>ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šä¸ä¸€è‡´ä¿®å¤ ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p><code>disabled</code>ï¼šä½œä¸šæ˜¯å¦ç¦ç”¨æ‰§è¡Œã€‚é»˜è®¤ä¸º <code>false</code>ã€‚é€‰å¡«ã€‚</p></li><li><p><code>overwrite</code>ï¼šè®¾ç½®ä½¿ç”¨æœ¬åœ°ä½œä¸šé…ç½®è¦†ç›–æ³¨å†Œä¸­å¿ƒçš„ä½œä¸šé…ç½®ã€‚é»˜è®¤ä¸º <code>false</code>ã€‚é€‰å¡«ã€‚å»ºè®®ä½¿ç”¨**è¿ç»´å¹³å°( console )**é…ç½®ä½œä¸šé…ç½®ï¼Œç»Ÿä¸€ç®¡ç†ã€‚</p></li><li><p>Builder ç±»ï¼šä½¿ç”¨è¯¥ç±»é…ç½® LiteJobConfiguration å±æ€§ï¼Œè°ƒç”¨ <code>#build()</code> æ–¹æ³•æœ€ç»ˆç”Ÿæˆä½œä¸šé…ç½®ã€‚å‚è§ï¼š<a href="http://blog.csdn.net/top_code/article/details/8469297" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠJAVAè®¾è®¡æ¨¡å¼ â€” ç”Ÿæˆå™¨æ¨¡å¼(Builder)ã€‹</a>ã€‚</p></li></ul><h3>2.2.1 ä½œä¸šç±»å‹é…ç½®</h3><p>ä½œä¸šç±»å‹é…ç½®<strong>æ¥å£</strong>( <a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/config/JobTypeConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">JobTypeConfiguration</a> ) æœ‰ä¸‰ç§é…ç½®å®ç°ï¼Œé’ˆå¯¹ä¸‰ç§ä½œä¸šç±»å‹ï¼š</p><table><thead><tr><th style="text-align:left">é…ç½®å®ç°</th><th style="text-align:left">ä½œä¸š</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/config/simple/SimpleJobConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">SimpleJobConfiguration</a></td><td style="text-align:left">SimpleJob</td><td style="text-align:left">ç®€å•ä½œä¸šã€‚ä¾‹å¦‚ï¼šè®¢å•è¿‡æœŸä½œä¸š</td></tr><tr><td style="text-align:left"><a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/config/dataflow/DataflowJobConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">DataflowJobConfiguration</a></td><td style="text-align:left">DataflowJob</td><td style="text-align:left">æ•°æ®æµä½œä¸šã€‚TODOï¼šç¬”è€…æš‚æ—¶æœªäº†è§£æµå¼å¤„ç†æ•°æ®ï¼Œä¸è¯¯äººå­å¼Ÿ</td></tr><tr><td style="text-align:left"><a href="https://github.com/dangdangdotcom/elastic-job/blob/6617853bf059df373e2cb6ce959038c583ae5064/elastic-job-common/elastic-job-common-core/src/main/java/com/dangdang/ddframe/job/config/script/ScriptJobConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">ScriptJobConfiguration</a></td><td style="text-align:left">ScriptJob</td><td style="text-align:left">è„šæœ¬ä½œä¸šã€‚ä¾‹å¦‚ï¼šè°ƒç”¨ shell è„šæœ¬å¤‡ä»½æ•°æ®åº“ä½œä¸š</td></tr></tbody></table><p>ä¸‰ç§<strong>é…ç½®ç±»</strong>å±æ€§å¯¹æ¯”å¦‚ï¼š</p><table><thead><tr><th style="text-align:left">å±æ€§</th><th style="text-align:left">SimpleJob</th><th style="text-align:left">DataflowJob</th><th style="text-align:left">ScriptJob</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><code>coreConfig</code></td><td style="text-align:left">âˆš</td><td style="text-align:left">âˆš</td><td style="text-align:left">âˆš</td><td style="text-align:left">ä½œä¸šæ ¸å¿ƒé…ç½®</td></tr><tr><td style="text-align:left"><code>jobType</code></td><td style="text-align:left">JobType.SIMPLE</td><td style="text-align:left">JobType.DATAFLOW</td><td style="text-align:left">JobType.SCRIPT</td><td style="text-align:left">ä½œä¸šç±»å‹</td></tr><tr><td style="text-align:left"><code>jobClass</code></td><td style="text-align:left">âˆš</td><td style="text-align:left">âˆš</td><td style="text-align:left">âˆš&lt;br /&gt;(é»˜è®¤ï¼šScriptJob.class)</td><td style="text-align:left">ä½œä¸šå®ç°ç±»å…¨è·¯å¾„</td></tr><tr><td style="text-align:left"><code>streamingProcess</code></td><td style="text-align:left"></td><td style="text-align:left">âˆš</td><td style="text-align:left"></td><td style="text-align:left">æ˜¯å¦æµå¼å¤„ç†æ•°æ®</td></tr><tr><td style="text-align:left"><code>scriptCommandLine</code></td><td style="text-align:left"></td><td style="text-align:left"></td><td style="text-align:left">âˆš</td><td style="text-align:left">è„šæœ¬å‹ä½œä¸šæ‰§è¡Œå‘½ä»¤è¡Œ</td></tr></tbody></table><p><strong>ä½œä¸šç±»å‹é…ç½®ä¸ä»…ä»…é€‚ç”¨äº Elastic-Job-Liteï¼Œä¹Ÿé€‚ç”¨äº Elastic-Job-Cloudã€‚</strong></p><h3>2.2.2 ä½œä¸šæ ¸å¿ƒé…ç½®</h3><p>ä½œä¸šæ ¸å¿ƒé…ç½®( JobCoreConfiguration )ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ¯ç§ä½œä¸šç±»å‹é…ç½®éƒ½æœ‰è¯¥å±æ€§( <code>coreConfig</code> )ã€‚</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JobCoreConfiguration</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String jobName;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String cron;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> shardingTotalCount;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String shardingItemParameters;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String jobParameter;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> failover;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> misfire;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JobProperties jobProperties;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">    </div><div class="line">        <span class="comment">// .... çœç•¥éƒ¨åˆ†å±æ€§</span></div><div class="line">    </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> JobCoreConfiguration <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            Preconditions.checkArgument(!Strings.isNullOrEmpty(jobName), <span class="string">"jobName can not be empty."</span>);</div><div class="line">            Preconditions.checkArgument(!Strings.isNullOrEmpty(cron), <span class="string">"cron can not be empty."</span>);</div><div class="line">            Preconditions.checkArgument(shardingTotalCount &gt; <span class="number">0</span>, <span class="string">"shardingTotalCount should larger than zero."</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JobCoreConfiguration(jobName, cron, shardingTotalCount, shardingItemParameters, jobParameter, failover, misfire, description, jobProperties);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li><p><code>jobName</code>ï¼šä½œä¸šåç§°ã€‚<strong>å¿…å¡«ã€‚</strong></p></li><li><p><code>cron</code>ï¼šcronè¡¨è¾¾å¼ï¼Œç”¨äºæ§åˆ¶ä½œä¸šè§¦å‘æ—¶é—´ã€‚<strong>å¿…å¡«ã€‚</strong></p></li><li><p><code>shardingTotalCount</code>ï¼šä½œä¸šåˆ†ç‰‡æ€»æ•°ã€‚å¦‚æœä¸€ä¸ªä½œä¸šå¯åŠ¨è¶…è¿‡ä½œä¸šåˆ†ç‰‡æ€»æ•°çš„èŠ‚ç‚¹ï¼Œåªæœ‰ <code>shardingTotalCount</code> ä¼šæ‰§è¡Œä½œä¸šã€‚**å¿…å¡«ã€‚**åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šåˆ†ç‰‡ç­–ç•¥ ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p><code>shardingItemParameters</code>ï¼šåˆ†ç‰‡åºåˆ—å·å’Œå‚æ•°ã€‚é€‰å¡«ã€‚</p><blockquote><p>åˆ†ç‰‡åºåˆ—å·å’Œå‚æ•°ç”¨ç­‰å·åˆ†éš”ï¼Œå¤šä¸ªé”®å€¼å¯¹ç”¨é€—å·åˆ†éš”<br>åˆ†ç‰‡åºåˆ—å·ä»0å¼€å§‹ï¼Œ<strong>ä¸å¯å¤§äºæˆ–ç­‰äº</strong>ä½œä¸šåˆ†ç‰‡æ€»æ•°<br>å¦‚ï¼š<br>0=a,1=b,2=c</p></blockquote></li><li><p><code>jobParameter</code>ï¼šä½œä¸šè‡ªå®šä¹‰å‚æ•°ã€‚é€‰å¡«ã€‚</p><blockquote><p>ä½œä¸šè‡ªå®šä¹‰å‚æ•°ï¼Œå¯é€šè¿‡ä¼ é€’è¯¥å‚æ•°ä¸ºä½œä¸šè°ƒåº¦çš„ä¸šåŠ¡æ–¹æ³•ä¼ å‚ï¼Œç”¨äºå®ç°å¸¦å‚æ•°çš„ä½œä¸š<br>ä¾‹ï¼šæ¯æ¬¡è·å–çš„æ•°æ®é‡ã€ä½œä¸šå®ä¾‹ä»æ•°æ®åº“è¯»å–çš„ä¸»é”®ç­‰</p></blockquote></li><li><p><code>failover</code>ï¼šæ˜¯å¦å¼€å¯ä»»åŠ¡æ‰§è¡Œå¤±æ•ˆè½¬ç§»ã€‚<strong>å¼€å¯è¡¨ç¤ºå¦‚æœä½œä¸šåœ¨ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œä¸­é€”å®•æœºï¼Œå…è®¸å°†è¯¥æ¬¡æœªå®Œæˆçš„ä»»åŠ¡åœ¨å¦ä¸€ä½œä¸šèŠ‚ç‚¹ä¸Šè¡¥å¿æ‰§è¡Œ</strong>ã€‚é»˜è®¤ä¸º <code>false</code>ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä»»åŠ¡å¤±æ•ˆè½¬ç§» ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p><code>misfire</code>ï¼šæ˜¯å¦å¼€å¯é”™è¿‡ä»»åŠ¡é‡æ–°æ‰§è¡Œã€‚é»˜è®¤ä¸º <code>true</code>ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä»»åŠ¡æ‰§è¡Œ ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p><code>description</code>ï¼šä½œä¸šæè¿°ã€‚é€‰å¡«ã€‚</p></li><li><p><code>jobProperties</code>ï¼šä½œä¸šå±æ€§é…ç½®ã€‚é€‰å¡«ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä»»åŠ¡æ‰§è¡Œ ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">JobProperties</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> EnumMap&lt;JobPropertiesEnum, String&gt; map = <span class="keyword">new</span> EnumMap&lt;&gt;(JobPropertiesEnum.class);</div><div class="line">    </div><div class="line">   <span class="keyword">public</span> <span class="keyword">enum</span> JobPropertiesEnum &#123;</div><div class="line">        </div><div class="line">        <span class="comment">/**</span></div><div class="line">         * ä½œä¸šå¼‚å¸¸å¤„ç†å™¨.</div><div class="line">         */</div><div class="line">        JOB_EXCEPTION_HANDLER(<span class="string">"job_exception_handler"</span>, JobExceptionHandler.class, DefaultJobExceptionHandler.class.getCanonicalName()),</div><div class="line">        </div><div class="line">        <span class="comment">/**</span></div><div class="line">         * çº¿ç¨‹æ± æœåŠ¡å¤„ç†å™¨.</div><div class="line">         */</div><div class="line">        EXECUTOR_SERVICE_HANDLER(<span class="string">"executor_service_handler"</span>, ExecutorServiceHandler.class, DefaultExecutorServiceHandler.class.getCanonicalName());</div><div class="line">        </div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String key;</div><div class="line">    </div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; classType;</div><div class="line">        </div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String defaultValue;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li><code>JOB_EXCEPTION_HANDLER</code>ï¼šç”¨äºæ‰©å±•<strong>å¼‚å¸¸å¤„ç†</strong>ç±»ã€‚</li><li><code>EXECUTOR_SERVICE_HANDLER</code>ï¼šç”¨äºæ‰©å±•<strong>ä½œä¸šå¤„ç†çº¿ç¨‹æ± </strong>ç±»ã€‚</li><li>é€šè¿‡è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰<strong>æ¯ä¸ªä½œä¸š</strong>çš„å¼‚å¸¸å¤„ç†å’Œçº¿ç¨‹æ± æœåŠ¡ã€‚</li></ul></li></ul><h2>2.3 ä½œä¸šäº‹ä»¶é…ç½®</h2><p>é€šè¿‡ä½œä¸šäº‹ä»¶é…ç½®( JobEventConfiguration )ï¼Œå®ç°å¯¹ä½œä¸šäº‹ä»¶çš„<strong>å¼‚æ­¥</strong>ç›‘å¬ã€å¤„ç†ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šäº‹ä»¶ä¸è¿½è¸ªã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><h2>2.4 ä½œä¸šç›‘å¬å™¨</h2><p>é€šè¿‡é…ç½®ä½œä¸šç›‘å¬å™¨( ElasticJobListener )ï¼Œå®ç°å¯¹ä½œä¸šæ‰§è¡Œçš„<strong>åŒæ­¥</strong>ç›‘å¬ã€å¤„ç†ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” ä½œä¸šç›‘å¬å™¨ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p><h1>3. ä½œä¸šé…ç½®æœåŠ¡</h1><p>å¤šä¸ª Elastic-Job-Lite ä½¿ç”¨ç›¸åŒ<strong>æ³¨å†Œä¸­å¿ƒ</strong>å’Œç›¸åŒ <strong><code>namespace</code></strong> ç»„æˆé›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨ã€‚é›†ç¾¤ä¸­ï¼Œä½¿ç”¨ä½œä¸šé…ç½®æœåŠ¡( ConfigurationService ) å…±äº«ä½œä¸šé…ç½®ã€‚</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigurationService</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ—¶é—´æœåŠ¡</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TimeService timeService;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ä½œä¸šèŠ‚ç‚¹æ•°æ®è®¿é—®ç±»</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JobNodeStorage jobNodeStorage;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConfigurationService</span><span class="params">(<span class="keyword">final</span> CoordinatorRegistryCenter regCenter, <span class="keyword">final</span> String jobName)</span> </span>&#123;</div><div class="line">        jobNodeStorage = <span class="keyword">new</span> JobNodeStorage(regCenter, jobName);</div><div class="line">        timeService = <span class="keyword">new</span> TimeService();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li><p>JobNodeStorageï¼Œå°è£…æ³¨å†Œä¸­å¿ƒï¼Œæä¾›å­˜å‚¨æœåŠ¡ã€‚åœ¨<a href="http://www.yunai.me/images/common/wechat_mp_2017_07_31_bak.jpg">ã€ŠElastic-Job-Lite æºç è§£æ â€”â€” æ•°æ®å­˜å‚¨ã€‹</a>è¯¦ç»†åˆ†äº«ã€‚</p></li><li><p>TimeServiceï¼Œæ—¶é—´æœåŠ¡ï¼Œæä¾›å½“å‰æ—¶é—´æŸ¥è¯¢ã€‚</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeService</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è·å–å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°.</div><div class="line">     * </div><div class="line">     * <span class="doctag">@return</span> å½“å‰æ—¶é—´çš„æ¯«ç§’æ•°</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getCurrentMillis</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> System.currentTimeMillis();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p></li></ul><h2>3.1 è¯»å–ä½œä¸šé…ç½®</h2><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* è¯»å–ä½œä¸šé…ç½®.</div><div class="line">* </div><div class="line">* <span class="doctag">@param</span> fromCache æ˜¯å¦ä»ç¼“å­˜ä¸­è¯»å–</div><div class="line">* <span class="doctag">@return</span> ä½œä¸šé…ç½®</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> LiteJobConfiguration <span class="title">load</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> fromCache)</span> </span>&#123;</div><div class="line">   String result;</div><div class="line">   <span class="keyword">if</span> (fromCache) &#123; <span class="comment">// ç¼“å­˜</span></div><div class="line">       result = jobNodeStorage.getJobNodeData(ConfigurationNode.ROOT);</div><div class="line">       <span class="keyword">if</span> (<span class="keyword">null</span> == result) &#123;</div><div class="line">           result = jobNodeStorage.getJobNodeDataDirectly(ConfigurationNode.ROOT);</div><div class="line">       &#125;</div><div class="line">   &#125; <span class="keyword">else</span> &#123;</div><div class="line">       result = jobNodeStorage.getJobNodeDataDirectly(ConfigurationNode.ROOT);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> LiteJobConfigurationGsonFactory.fromJson(result);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h2>3.2 æŒä¹…åŒ–ä½œä¸šé…ç½®</h2><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* æŒä¹…åŒ–åˆ†å¸ƒå¼ä½œä¸šé…ç½®ä¿¡æ¯.</div><div class="line">* </div><div class="line">* <span class="doctag">@param</span> liteJobConfig ä½œä¸šé…ç½®</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">persist</span><span class="params">(<span class="keyword">final</span> LiteJobConfiguration liteJobConfig)</span> </span>&#123;</div><div class="line">   checkConflictJob(liteJobConfig);</div><div class="line">   <span class="keyword">if</span> (!jobNodeStorage.isJobNodeExisted(ConfigurationNode.ROOT) || liteJobConfig.isOverwrite()) &#123;</div><div class="line">       jobNodeStorage.replaceJobNode(ConfigurationNode.ROOT, LiteJobConfigurationGsonFactory.toJson(liteJobConfig));</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li><p>è°ƒç”¨ <code>#checkConflictJob(...)</code> æ–¹æ³•<strong>æ ¡éªŒ</strong>æ³¨å†Œä¸­å¿ƒå­˜å‚¨çš„ä½œä¸šé…ç½®çš„ä½œä¸šå®ç°ç±»å…¨è·¯å¾„( <code>jobClass</code> )å’Œå½“å‰çš„æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸åŒï¼Œåˆ™è®¤ä¸ºæ˜¯<strong>å†²çª</strong>ï¼Œä¸å…è®¸å­˜å‚¨ï¼š</p><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkConflictJob</span><span class="params">(<span class="keyword">final</span> LiteJobConfiguration liteJobConfig)</span> </span>&#123;</div><div class="line">   Optional&lt;LiteJobConfiguration&gt; liteJobConfigFromZk = find();</div><div class="line">   <span class="keyword">if</span> (liteJobConfigFromZk.isPresent()</div><div class="line">           &amp;&amp; !liteJobConfigFromZk.get().getTypeConfig().getJobClass().equals(liteJobConfig.getTypeConfig().getJobClass())) &#123; <span class="comment">// jobClass æ˜¯å¦ç›¸åŒ</span></div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> JobConfigurationException(<span class="string">"Job conflict with register center. The job '%s' in register center's class is '%s', your job class is '%s'"</span>, </div><div class="line">               liteJobConfig.getJobName(), liteJobConfigFromZk.get().getTypeConfig().getJobClass(), liteJobConfig.getTypeConfig().getJobClass());</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p></li></ul><ul><li>å½“æ³¨å†Œä¸­å¿ƒ<strong>æœªå­˜å‚¨</strong>è¯¥ä½œä¸šé…ç½® æˆ–è€… å½“å‰ä½œä¸šé…ç½®å…è®¸æ›¿æ¢æ³¨å†Œä¸­å¿ƒä½œä¸šé…ç½®( <code>overwrite = true</code> )æ—¶ï¼ŒæŒä¹…åŒ–ä½œä¸šé…ç½®ã€‚</li></ul><h2>3.3 æ ¡éªŒæœ¬æœºæ—¶é—´æ˜¯å¦åˆæ³•</h2><p></p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">* æ£€æŸ¥æœ¬æœºä¸æ³¨å†Œä¸­å¿ƒçš„æ—¶é—´è¯¯å·®ç§’æ•°æ˜¯å¦åœ¨å…è®¸èŒƒå›´.</div><div class="line">* </div><div class="line">* <span class="doctag">@throws</span> JobExecutionEnvironmentException æœ¬æœºä¸æ³¨å†Œä¸­å¿ƒçš„æ—¶é—´è¯¯å·®ç§’æ•°ä¸åœ¨å…è®¸èŒƒå›´æ‰€æŠ›å‡ºçš„å¼‚å¸¸</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkMaxTimeDiffSecondsTolerable</span><span class="params">()</span> <span class="keyword">throws</span> JobExecutionEnvironmentException </span>&#123;</div><div class="line">   <span class="keyword">int</span> maxTimeDiffSeconds =  load(<span class="keyword">true</span>).getMaxTimeDiffSeconds();</div><div class="line">   <span class="keyword">if</span> (-<span class="number">1</span>  == maxTimeDiffSeconds) &#123;</div><div class="line">       <span class="keyword">return</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">long</span> timeDiff = Math.abs(timeService.getCurrentMillis() - jobNodeStorage.getRegistryCenterTime());</div><div class="line">   <span class="keyword">if</span> (timeDiff &gt; maxTimeDiffSeconds * <span class="number">1000L</span>) &#123;</div><div class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> JobExecutionEnvironmentException(</div><div class="line">               <span class="string">"Time different between job server and register center exceed '%s' seconds, max time different is '%s' seconds."</span>, timeDiff / <span class="number">1000</span>, maxTimeDiffSeconds);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><ul><li>Elastic-Job-Lite ä½œä¸šè§¦å‘æ˜¯<strong>ä¾èµ–æœ¬æœºæ—¶é—´</strong>ï¼Œç›¸åŒé›†ç¾¤ä½¿ç”¨æ³¨å†Œä¸­å¿ƒæ—¶é—´ä¸ºåŸºå‡†ï¼Œæ ¡éªŒæœ¬æœºä¸æ³¨å†Œä¸­å¿ƒçš„æ—¶é—´è¯¯å·®æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…( <code>LiteJobConfiguration.maxTimeDiffSeconds</code> )ã€‚</li></ul><h1>666. å½©è›‹</h1><p>Elastic-Job-Lite æºç è§£æç³»åˆ—ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œé¢„è®¡å…¨éƒ¨æ›´æ–°å®Œä¼šæœ‰ 15+ ç¯‡ã€‚Elastic-Job-Cloud æºç ç³»åˆ—åç»­ä¹Ÿä¼šæ›´æ–°ã€‚</p><p>é“å‹ï¼Œåˆ†äº«ä¸€æ³¢<strong>å¾®ä¿¡æœ‹å‹åœˆ</strong>æ”¯æŒæ”¯æŒæ”¯æŒï¼Œå¯å¥½ï¼Ÿ</p></div><footer class="article-footer clearfix"><div class="article-categories"><span></span> <a class="article-category-link" href="/categories/Elastic-Job/">Elastic-Job</a></div><div class="article-share" id="share"><div data-url="http://www.yunai.me/Elastic-Job/job-config/" data-title="Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šé…ç½® | èŠ‹è‰¿Vçš„åšå®¢" data-tsina="null" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/Elastic-Job/job-init/" title="Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šåˆå§‹åŒ–"><strong>PREVIOUS:</strong><br><span>Elastic-Job æºç åˆ†æ â€”â€” ä½œä¸šåˆå§‹åŒ–</span></a></div><div class="next"><a href="/Elastic-Job/why-read-Elastic-Job-source-code/" title="Elastic-Job æºç åˆ†æ â€”â€” ä¸ºä»€ä¹ˆé˜…è¯» Elastic-Job æºç ï¼Ÿ"><strong>NEXT:</strong><br><span>Elastic-Job æºç åˆ†æ â€”â€” ä¸ºä»€ä¹ˆé˜…è¯» Elastic-Job æºç ï¼Ÿ</span></a></div></nav></div></div><footer><div id="footer"><p class="copyright">Â© 2017 <a href="http://www.yunai.me" target="_blank" title="ç‹æ–‡æ–Œ">ç‹æ–‡æ–Œ</a> && <span style="display:inline" id="busuanzi_container_site_uv">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span> && <span style="display:inline" id="busuanzi_container_site_pv">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span> && Hosted by <a href="https://pages.coding.me" style="font-weight:700" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a> && Powered by <a href="http://hexo.io" target="_blank" title="hexo" rel="external nofollow noopener noreferrer">hexo</a> && Theme by <a href="http://gengbiao.me" target="_blank" title="coney" rel="external nofollow noopener noreferrer">coney</a></p></div></footer><script src="/js/jquery-2.1.0.min.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"),$("#toc.toc-aside").css("display","none"))}),o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){var a=$(".article-content>iframe"),t=$(".article-content>embed"),n=$("#toc");$("article h2");ah=$("article h2"),ta=$("#toc.toc-aside"),o=$(".openaside"),c=$(".closeaside"),a.length>0&&a.wrap('<div class="video-container" />'),t.length>0&&t.wrap('<div class="video-container" />'),0==ah.length?n.css("display","none"):(c.click(function(){ta.css("display","block").addClass("fadeIn")}),o.click(function(){ta.css("display","none")}),$(window).scroll(function(){ta.css("top",Math.max(140,320-$(this).scrollTop()))}))})</script><script type="text/javascript">$(document).ready(function(){var t=$(".share"),a=t.attr("data-url"),e=encodeURIComponent(a),r=['<a href="#" class="overlay" id="qrcode"></a>','<div class="qrcode clearfix"><span>æ‰«æäºŒç»´ç åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url='+e+'"/></div>','<a href="#textlogo" class="article-back-to-top" title="Top"></a>','<a href="https://www.facebook.com/sharer.php?u='+e+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>','<a href="https://twitter.com/intent/tweet?url='+e+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="http://service.weibo.com/share/share.php?title='+t.attr("data-title")+"&url="+e+"&ralateUid="+t.attr("data-tsina")+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="Weibo"></a>','<span title="Share to"></span>'].join("");t.append(r),$(".article-share-qrcode").click(function(){var t=$("#qrcode-pic").attr("data-src");$("#qrcode-pic").attr("src",t),$("#qrcode-pic").load(function(){$(".qrcode strong").text(" ")})})})</script><link rel="stylesheet" href="/alert/css/alert.css"><script src="/alert/js/alert.js"></script><script src="/js/jquery.cookie.js"></script><script>$(document).ready(function(){function e(){var e=jqueryAlert({title:"ğŸ‘¼æ¯å‘¨å…­æ›´æ–°ä¸€ç¯‡æºç è§£æï¼Œã€æ‰«ä¸€æ‰«ã€‘å…³æ³¨å…¬ä¼—å·ğŸ‘¼",width:"500",height:"580",modal:!0,content:n+'<p style="color: red">ä»Šæ—¥'+c+"å·²å…³æ³¨äººæ•°ï¼š"+p+'</p><img width="400" src="http://www.yunai.me/images/common/wechat_mp_simple.png" /><p style="color: red">å…³æ³¨åï¼Œæ¬¢è¿åŠ å…¥ã€æºç åœˆã€‘å¾®ä¿¡ç¾¤äº¤æµ</p><p style="color: red">ä¸€èµ·çœ‹æºç ï¼Œè¯»æºç ï¼Œæå‡æŠ€æœ¯ï¼</p>',buttons:{"å·²å…³æ³¨ï¼Œå…³é—­çª—å£ï¼ˆå…¬ä¼—å·å‘é€ï¼šã€å£ä»¤ã€‘å±è”½å¼¹çª—ï¼‰":function(){e.close()}}});$.cookie(o,i+1,{expires:1,path:"/"})}if(!(location.href.indexOf("vip")>=0||location.href.indexOf("127.0.0.1")>=0)){var o="doubi",i=$.cookie(o);i?i=parseInt(i):($.cookie(o,0,{expires:1,path:"/"}),i=0),$.cookie(o,i,{expires:1,path:"/"});var t="default",r={juejin:"æ˜é‡‘",oschina:"å¼€æºä¸­å›½",sjdbc:"Sharding-JDBC",jianshu:"ç®€ä¹¦",csdn:"CSDN",iteye:"iteye",cnblogs:"åšå®¢å›­"};for(var a in r)if(location.search.indexOf(a)>=0){t=a;break}"default"===t&&(t=$.cookie("from")||"default"),$.cookie("from",t,{expires:365,path:"/"});var n="",c="";if(t&&r[t]&&(n='<p style="color: red">æ¬¢è¿æ¥è‡ªã€'+r[t]+"ã€‘çš„åŒå­¦</p>",c="ã€"+r[t]+"ã€‘"),i<=3){var p=103+5*(new Date).getHours();setTimeout(e,1e4*(i+1))}}})</script></body>