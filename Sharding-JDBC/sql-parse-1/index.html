<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="google-site-verification" content="GkJ68PCnxM9Ih7Zm9v8p91FOCV7ymNCO2KdGbflLh3E">
    <meta name="360-site-verification" content="dd6547587641bfede036f7c79561e8a0">
    <meta name="shenma-site-verification" content="fd96cf3751972c9b05f8471d2ccadddc_1496951214">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="msvalidate.01" content="1D38B05050A977F6FDEDA481198343F1">
    <meta name="sogou_site_verification" content="MpPsku240L">
    <meta name="description" content="ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹è‰¿çš„åç«¯å°å±‹ã€‘**æœ‰ç¦åˆ©ï¼š  RocketMQ / MyCAT / Sharding-JDBC æ‰€æœ‰æºç åˆ†ææ–‡ç« åˆ—è¡¨ RocketMQ / MyCAT / Sharding-JDBC ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€ æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤ã€‚ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢ã€‚ æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ã€‚æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³ã€‚    1. æ¦‚">
<meta name="keywords" content="Java,æ¶æ„,åç«¯,æœåŠ¡ç«¯,RocketMQ,MyCAT,åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—,åˆ†å¸ƒå¼å­˜å‚¨,æŠ€æœ¯åšå®¢">
<meta property="og:type" content="article">
<meta property="og:title" content="Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ">
<meta property="og:url" content="http://www.yunai.me/Sharding-JDBC/sql-parse-1/index.html">
<meta property="og:site_name" content="èŠ‹è‰¿Vçš„åšå®¢">
<meta property="og:description" content="ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹è‰¿çš„åç«¯å°å±‹ã€‘**æœ‰ç¦åˆ©ï¼š  RocketMQ / MyCAT / Sharding-JDBC æ‰€æœ‰æºç åˆ†ææ–‡ç« åˆ—è¡¨ RocketMQ / MyCAT / Sharding-JDBC ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€ æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤ã€‚ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢ã€‚ æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ã€‚æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³ã€‚    1. æ¦‚">
<meta property="og:image" content="http://www.yunai.me/images/common/wechat_mp.jpeg">
<meta property="og:image" content="http://www.yunai.me/images/Sharding-JDBC/2017_07_23/01.png">
<meta property="og:image" content="http://www.yunai.me/images/Sharding-JDBC/2017_07_23/02.png">
<meta property="og:image" content="http://www.yunai.me/images/Sharding-JDBC/2017_07_23/03.png">
<meta property="og:image" content="http://www.yunai.me/images/Sharding-JDBC/2017_07_23/04.png">
<meta property="og:updated_time" content="2017-07-23T08:28:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ">
<meta name="twitter:description" content="ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹è‰¿çš„åç«¯å°å±‹ã€‘**æœ‰ç¦åˆ©ï¼š  RocketMQ / MyCAT / Sharding-JDBC æ‰€æœ‰æºç åˆ†ææ–‡ç« åˆ—è¡¨ RocketMQ / MyCAT / Sharding-JDBC ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€ æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤ã€‚ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢ã€‚ æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ã€‚æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³ã€‚    1. æ¦‚">
<meta name="twitter:image" content="http://www.yunai.me/images/common/wechat_mp.jpeg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ</title>
    <!-- keywords -->
    
    <meta name="keywords" content="Java,æ¶æ„,åç«¯,æœåŠ¡ç«¯,RocketMQ,MyCAT,åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—,åˆ†å¸ƒå¼å­˜å‚¨,æŠ€æœ¯åšå®¢">
    
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    


    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>AV.initialize("uxUSudJeAFuAk0PKwFMY7MJW-gzGzoHsz", "NTPUE2VIEE0gyPPGbAaLPtLb");</script>
    <!-- ç™¾åº¦ç»Ÿè®¡ -->
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ef4ed89f6dc83d01803a2440ae21e666";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <!-- ç™¾åº¦ç«™é•¿-è¢«åŠ¨æ¨é€ -->
    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>

    <!-- 360æœç´¢-è‡ªåŠ¨æ”¶å½• -->
    <script>
        (function(){
            var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?f05b61dd54bbc38386611a5238672938":"https://jspassport.ssl.qhimg.com/11.0.1.js?f05b61dd54bbc38386611a5238672938";
            document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#" class="active"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" class="active"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:visible;">
    <i class="fa fa-chevron-up fa-lg"></i>
  </a>
  <span id="menu" style="visibility: visible;">
    <span id="nav">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="http://github.com/YunaiV">GitHub</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/MyCAT/connect-mongodb/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$(" #i-next").toggle();"="" onmouseout="$("></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$(" #i-top").toggle();"="" onmouseout="$("></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$(" #i-share").toggle();"="" onmouseout="$(" onclick="$(" #share").toggle();return="" false;"=""></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.yunai.me/Sharding-JDBC/sql-parse-1/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&text=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&is_video=false&description=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ&body=Check out this article: http://www.yunai.me/Sharding-JDBC/sql-parse-1/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&name=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ&description=" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">2. Lexer è¯æ³•è§£æå™¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">3. Token è¯æ³•æ ‡è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 DefaultKeyword è¯æ³•å…³é”®è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Literals è¯æ³•å­—é¢é‡æ ‡è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 Literals.IDENTIFIER è¯æ³•å…³é”®è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 Literals.VARIABLE å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 Literals.CHARS å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 Literals.HEX åå…­è¿›åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 Literals.INT æ•´æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.6 Literals.FLOAT æµ®ç‚¹æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Symbol è¯æ³•ç¬¦å·æ ‡è®°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 Assist è¯æ³•è¾…åŠ©æ ‡è®°</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">4. å½©è›‹</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">èŠ‹è‰¿Vçš„åšå®¢</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-07-22T16:00:00.000Z" itemprop="datePublished">2017-07-23</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="http://www.yunai.me/images/common/wechat_mp.jpeg" alt=""></p>
<blockquote>
<p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹è‰¿çš„åç«¯å°å±‹ã€‘**æœ‰ç¦åˆ©ï¼š</p>
<ol>
<li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨</li>
<li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong></li>
<li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚</li>
<li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚</li>
</ol>
</blockquote>
<hr>
<h1>1. æ¦‚è¿°</h1>
<p>SQL è§£æï¼Œæ•°æ®åº“ä¸­é—´ä»¶å¿…å¤‡çš„åŠŸèƒ½å’Œæµç¨‹ã€‚Sharding-JDBC åœ¨ <code>1.5.0</code> æ­£å¼å‘å¸ƒæ—¶ï¼Œå°† SQL è§£æå¼•æ“ä» Druid æ›¿æ¢æˆäº†è‡ªç ”çš„ã€‚<strong>æ–°å¼•æ“ä»…è§£æåˆ†ç‰‡ä¸Šä¸‹æ–‡ï¼Œå¯¹äº SQL é‡‡ç”¨&quot;åŠç†è§£&quot;ç†å¿µï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½å’Œå…¼å®¹æ€§ï¼ŒåŒæ—¶é™ä½äº†ä»£ç å¤æ‚åº¦</strong>ï¼ˆä¸ç†è§£æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åç»­ä¼šæ›´æ–°æ–‡ç« è§£é‡Šè¯¥ä¼˜ç‚¹ï¼‰ã€‚ å›½å†…å¦ä¸€æ¬¾æ•°æ®åº“ä¸­é—´ä»¶ MyCAT SQL è§£æå¼•æ“ä¹Ÿæ˜¯ Druidï¼Œç›®å‰ä¹Ÿåœ¨å±äºè‡ªå·±çš„ SQL è§£æå¼•æ“ã€‚</p>
<p>å¯èƒ½æœ‰åŒå­¦çœ‹åˆ°<strong>SQL è§£æ</strong>ä¼šè¢«å“åˆ°ï¼Œè¯·æ·¡å®šï¼Œè€å¿ƒå¾€ä¸‹çœ‹ã€‚ã€ŠSQL è§£æã€‹å†…å®¹æˆ‘ä»¬ä¼šåˆ†æˆ 5 ç¯‡ç›¸å¯¹ç®€çŸ­çš„æ–‡ç« ï¼Œè®©å¤§å®¶èƒ½å¤Ÿç›¸å¯¹è½»æ¾æ„‰å¿«çš„å»ç†è§£ï¼š</p>
<ol>
<li>è¯æ³•è§£æ</li>
<li>æ’å…¥ SQL è§£æ</li>
<li>æŸ¥è¯¢ SQL è§£æ</li>
<li>æ›´æ–° SQL è§£æ</li>
<li>åˆ é™¤ SQL è§£æ</li>
</ol>
<hr>
<p><img src="../../../images/Sharding-JDBC/2017_07_23/01.png" alt=""></p>
<p><strong>SQL è§£æå¼•æ“</strong>åœ¨ <code>parsing</code> åŒ…ä¸‹ï¼Œå¦‚ä¸Šå›¾æ‰€è§åŒ…å«ä¸¤å¤§ç»„ä»¶ï¼š</p>
<ol>
<li>Lexerï¼š<strong>è¯æ³•</strong>è§£æå™¨ã€‚</li>
<li>Parserï¼š<strong>SQL</strong>è§£æå™¨ã€‚</li>
</ol>
<p>ä¸¤è€…éƒ½æ˜¯è§£æå™¨ï¼ŒåŒºåˆ«åœ¨äº Lexer åªåšè¯æ³•çš„è§£æï¼Œä¸å…³æ³¨ä¸Šä¸‹æ–‡ï¼Œå°†å­—ç¬¦ä¸²æ‹†è§£æˆ N ä¸ªè¯æ³•ã€‚è€Œ Parser åœ¨ Lexer çš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€è¦ç†è§£ SQL ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<p><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user  </div><div class="line">Lexer ï¼š[<span class="keyword">SELECT</span>] [ * ] [<span class="keyword">FROM</span>] [t_user]  </div><div class="line">Parser ï¼šè¿™æ˜¯ä¸€æ¡æŸ¥è¯¢è¡¨ä¸º [t_user] ï¼Œå¹¶ä¸”è¿”å› [ * ] æ‰€æœ‰å­—æ®µçš„<span class="keyword">SQL</span>ã€‚</div></pre></td></tr></table></figure></p>
<p>ğŸ™‚ä¸å®Œå…¨æ‡‚ï¼Ÿæ²¡å…³ç³»ï¼Œæœ¬æ–‡çš„ä¸»è§’æ˜¯ Lexerï¼Œæˆ‘ä»¬é€šè¿‡æºç ä¸€ç‚¹ä¸€ç‚¹ç†è§£ã€‚ä¸€å…± 1400 è¡Œå·¦å³ä»£ç å·¦å³ï¼Œè¿˜åŒ…å«æ³¨é‡Šç­‰ç­‰ï¼Œå®é™…æ›´å°‘å™¢ã€‚</p>
<h1>2. Lexer è¯æ³•è§£æå™¨</h1>
<p><strong>Lexer åŸç†</strong>ï¼š<strong>é¡ºåºé¡ºåºé¡ºåº</strong> è§£æ SQLï¼Œå°†å­—ç¬¦ä¸²æ‹†è§£æˆ N ä¸ªè¯æ³•ã€‚</p>
<p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lexer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¾“å‡ºå­—ç¬¦ä¸²</div><div class="line">     * æ¯”å¦‚ï¼šSQL</div><div class="line">     */</div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String input;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¯æ³•æ ‡è®°å­—å…¸</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Dictionary dictionary;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è§£æåˆ° SQL çš„ offset</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> offset;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å½“å‰ è¯æ³•æ ‡è®°</div><div class="line">     */</div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="keyword">private</span> Token currentToken;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * åˆ†æä¸‹ä¸€ä¸ªè¯æ³•æ ‡è®°.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@see</span> #currentToken</div><div class="line">     * <span class="doctag">@see</span> #offset</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">nextToken</span><span class="params">()</span> </span>&#123;</div><div class="line">        skipIgnoredToken();</div><div class="line">        <span class="keyword">if</span> (isVariableBegin()) &#123; <span class="comment">// å˜é‡</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanVariable();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isNCharBegin()) &#123; <span class="comment">// N\</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, ++offset).scanChars();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isIdentifierBegin()) &#123; <span class="comment">// Keyword + Literals.IDENTIFIER</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanIdentifier();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isHexDecimalBegin()) &#123; <span class="comment">// åå…­è¿›åˆ¶</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanHexDecimal();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isNumberBegin()) &#123; <span class="comment">// æ•°å­—ï¼ˆæ•´æ•°+æµ®ç‚¹æ•°ï¼‰</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanNumber();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isSymbolBegin()) &#123; <span class="comment">// ç¬¦å·</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanSymbol();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isCharsBegin()) &#123; <span class="comment">// å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š"abc"</span></div><div class="line">            currentToken = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).scanChars();</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isEnd()) &#123; <span class="comment">// ç»“æŸ</span></div><div class="line">            currentToken = <span class="keyword">new</span> Token(Assist.END, <span class="string">""</span>, offset);</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// åˆ†æé”™è¯¯ï¼Œæ— ç¬¦åˆæ¡ä»¶çš„è¯æ³•æ ‡è®°</span></div><div class="line">            currentToken = <span class="keyword">new</span> Token(Assist.ERROR, <span class="string">""</span>, offset);</div><div class="line">        &#125;</div><div class="line">        offset = currentToken.getEndPosition();</div><div class="line">        <span class="comment">// System.out.println("| " + currentToken.getLiterals() + " | " + currentToken.getType() + " | " + currentToken.getEndPosition() + " |");</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è·³è¿‡å¿½ç•¥çš„è¯æ³•æ ‡è®°</div><div class="line">     * 1. ç©ºæ ¼</div><div class="line">     * 2. SQL Hint</div><div class="line">     * 3. SQL æ³¨é‡Š</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">skipIgnoredToken</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// ç©ºæ ¼</span></div><div class="line">        offset = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).skipWhitespace();</div><div class="line">        <span class="comment">// SQL Hint</span></div><div class="line">        <span class="keyword">while</span> (isHintBegin()) &#123;</div><div class="line">            offset = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).skipHint();</div><div class="line">            offset = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).skipWhitespace();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// SQL æ³¨é‡Š</span></div><div class="line">        <span class="keyword">while</span> (isCommentBegin()) &#123;</div><div class="line">            offset = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).skipComment();</div><div class="line">            offset = <span class="keyword">new</span> Tokenizer(input, dictionary, offset).skipWhitespace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é€šè¿‡ <code>#nextToken()</code> æ–¹æ³•ï¼Œä¸æ–­è§£æå‡º Token(<em>è¯æ³•æ ‡è®°</em>)ã€‚æˆ‘ä»¬æ¥æ‰§è¡Œä¸€æ¬¡ï¼Œçœ‹çœ‹ SQL ä¼šè¢«æ‹†è§£æˆå“ªäº› Tokenã€‚</p>
<p><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">SQL ï¼š<span class="keyword">SELECT</span> i.* <span class="keyword">FROM</span> t_order o <span class="keyword">JOIN</span> t_order_item i <span class="keyword">ON</span> o.order_id=i.order_id <span class="keyword">WHERE</span> o.user_id=? <span class="keyword">AND</span> o.order_id=?</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>literals</th>
<th>TokenTypeç±»</th>
<th>TokenTypeå€¼</th>
<th>endPosition</th>
</tr>
</thead>
<tbody>
<tr>
<td>SELECT</td>
<td>DefaultKeyword</td>
<td>SELECT</td>
<td>6</td>
</tr>
<tr>
<td>i</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>8</td>
</tr>
<tr>
<td>.</td>
<td>Symbol</td>
<td>DOT</td>
<td>9</td>
</tr>
<tr>
<td>*</td>
<td>Symbol</td>
<td>STAR</td>
<td>10</td>
</tr>
<tr>
<td>FROM</td>
<td>DefaultKeyword</td>
<td>FROM</td>
<td>15</td>
</tr>
<tr>
<td>t_order</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>23</td>
</tr>
<tr>
<td>o</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>25</td>
</tr>
<tr>
<td>JOIN</td>
<td>DefaultKeyword</td>
<td>JOIN</td>
<td>30</td>
</tr>
<tr>
<td>t_order_item</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>43</td>
</tr>
<tr>
<td>i</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>45</td>
</tr>
<tr>
<td>ON</td>
<td>DefaultKeyword</td>
<td>ON</td>
<td>48</td>
</tr>
<tr>
<td>o</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>50</td>
</tr>
<tr>
<td>.</td>
<td>Symbol</td>
<td>DOT</td>
<td>51</td>
</tr>
<tr>
<td>order_id</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>59</td>
</tr>
<tr>
<td>=</td>
<td>Symbol</td>
<td>EQ</td>
<td>60</td>
</tr>
<tr>
<td>i</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>61</td>
</tr>
<tr>
<td>.</td>
<td>Symbol</td>
<td>DOT</td>
<td>62</td>
</tr>
<tr>
<td>order_id</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>70</td>
</tr>
<tr>
<td>WHERE</td>
<td>DefaultKeyword</td>
<td>WHERE</td>
<td>76</td>
</tr>
<tr>
<td>o</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>78</td>
</tr>
<tr>
<td>.</td>
<td>Symbol</td>
<td>DOT</td>
<td>79</td>
</tr>
<tr>
<td>user_id</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>86</td>
</tr>
<tr>
<td>=</td>
<td>Symbol</td>
<td>EQ</td>
<td>87</td>
</tr>
<tr>
<td>?</td>
<td>Symbol</td>
<td>QUESTION</td>
<td>88</td>
</tr>
<tr>
<td>AND</td>
<td>DefaultKeyword</td>
<td>AND</td>
<td>92</td>
</tr>
<tr>
<td>o</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>94</td>
</tr>
<tr>
<td>.</td>
<td>Symbol</td>
<td>DOT</td>
<td>95</td>
</tr>
<tr>
<td>order_id</td>
<td>Literals</td>
<td>IDENTIFIER</td>
<td>103</td>
</tr>
<tr>
<td>=</td>
<td>Symbol</td>
<td>EQ</td>
<td>104</td>
</tr>
<tr>
<td>?</td>
<td>Symbol</td>
<td>QUESTION</td>
<td>105</td>
</tr>
<tr>
<td></td>
<td>Assist</td>
<td>END</td>
<td>105</td>
</tr>
</tbody>
</table>
<p>çœ¼å°–çš„åŒå­¦å¯èƒ½çœ‹åˆ°äº† Tokenizerã€‚å¯¹çš„ï¼Œå®ƒæ˜¯ Lexer çš„å¥½åŸºä½¬ï¼Œè´Ÿè´£<strong>åˆ†è¯</strong>ã€‚</p>
<p><em>æˆ‘ä»¬æ¥æ€»ç»“ä¸‹ï¼Œ<code>Lexer#nextToken()</code> æ–¹æ³•é‡Œï¼Œä½¿ç”¨ <code>#skipIgnoredToken()</code> æ–¹æ³•è·³è¿‡å¿½ç•¥çš„ Tokenï¼Œé€šè¿‡ <code>#isXXXX()</code> æ–¹æ³•åˆ¤æ–­å¥½ä¸‹ä¸€ä¸ª Token çš„ç±»å‹åï¼Œ<strong>äº¤ç»™ Tokenizer è¿›è¡Œåˆ†è¯è¿”å› Token</strong>ã€‚â€¼ï¸æ­¤å¤„å¯ä»¥è€ƒè™‘åšä¸ªä¼˜åŒ–ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½ <code>new Tokenizer(...)</code> å‡ºæ¥ï¼Œä¸€ä¸ª Lexer æ­é…ä¸€ä¸ª Tokenizerã€‚</em></p>
<hr>
<p>ç”±äºä¸åŒæ•°æ®åº“éµå®ˆ SQL è§„èŒƒç•¥æœ‰ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„æ•°æ®åº“å¯¹åº”ä¸åŒçš„ Lexerã€‚</p>
<p><img src="../../../images/Sharding-JDBC/2017_07_23/02.png" alt=""></p>
<p>å­ Lexer é€šè¿‡é‡å†™æ–¹æ³•å®ç°è‡ªå·±ç‹¬æœ‰çš„ SQL è¯­æ³•ã€‚</p>
<h1>3. Token è¯æ³•æ ‡è®°</h1>
<p>ä¸Šæ–‡æˆ‘ä»¬å·²ç»çœ‹è¿‡ Token çš„ä¾‹å­ï¼Œä¸€å…±æœ‰ 3 ä¸ªå±æ€§ï¼š</p>
<ul>
<li>TokenType type ï¼šè¯æ³•æ ‡è®°ç±»å‹</li>
<li>String literals ï¼šè¯æ³•å­—é¢é‡æ ‡è®°</li>
<li>endPosition ï¼š<code>literals</code> åœ¨ SQL é‡Œçš„ç»“æŸä½ç½®</li>
</ul>
<p>TokenType è¯æ³•æ ‡è®°ç±»å‹ï¼Œä¸€å…±åˆ†æˆ 4 ä¸ªå¤§ç±»ï¼š</p>
<ul>
<li>DefaultKeyword ï¼šè¯æ³•å…³é”®è¯</li>
<li>Literals ï¼šè¯æ³•å­—é¢é‡æ ‡è®°</li>
<li>Symbol ï¼šè¯æ³•ç¬¦å·æ ‡è®°</li>
<li>Assist ï¼šè¯æ³•è¾…åŠ©æ ‡è®°</li>
</ul>
<p><img src="../../../images/Sharding-JDBC/2017_07_23/03.png" alt=""></p>
<h2>3.1 DefaultKeyword è¯æ³•å…³é”®è¯</h2>
<p><img src="../../../images/Sharding-JDBC/2017_07_23/04.png" alt=""></p>
<p><strong>ä¸åŒæ•°æ®åº“æœ‰è‡ªå·±ç‹¬æœ‰çš„_è¯æ³•å…³é”®è¯_ï¼Œä¾‹å¦‚ MySQL ç†ŸçŸ¥çš„åˆ†é¡µ Limitã€‚</strong></p>
<p>æˆ‘ä»¬ä»¥ MySQL ä¸¾ä¸ªä¾‹å­ï¼Œå½“åˆ›å»º MySQLLexer æ—¶ï¼Œä¼šåŠ è½½ DefaultKeyword å’Œ MySQLKeywordï¼ˆ <em>OracleLexerã€PostgreSQLLexerã€SQLServerLexer åŒ MySQLLexer</em> ï¼‰ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// MySQLLexer.java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MySQLLexer</span> <span class="keyword">extends</span> <span class="title">Lexer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å­—å…¸</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Dictionary dictionary = <span class="keyword">new</span> Dictionary(MySQLKeyword.values());</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySQLLexer</span><span class="params">(<span class="keyword">final</span> String input)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(input, dictionary);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Dictionary.java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Dictionary</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è¯æ³•å…³é”®è¯Map</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Keyword&gt; tokens = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">1024</span>);</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dictionary</span><span class="params">(<span class="keyword">final</span> Keyword... dialectKeywords)</span> </span>&#123;</div><div class="line">        fill(dialectKeywords);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è£…ä¸Šé»˜è®¤è¯æ³•å…³é”®è¯ + æ–¹è¨€è¯æ³•å…³é”®è¯</div><div class="line">     * ä¸åŒçš„æ•°æ®åº“æœ‰ç›¸åŒçš„é»˜è®¤è¯æ³•å…³é”®è¯ï¼Œæœ‰æœ‰ä¸åŒçš„æ–¹è¨€å…³é”®è¯</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> dialectKeywords æ–¹è¨€è¯æ³•å…³é”®è¯</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(<span class="keyword">final</span> Keyword... dialectKeywords)</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (DefaultKeyword each : DefaultKeyword.values()) &#123;</div><div class="line">            tokens.put(each.name(), each);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (Keyword each : dialectKeywords) &#123;</div><div class="line">            tokens.put(each.toString(), each);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Keyword ä¸ Literals.IDENTIFIER æ˜¯ä¸€èµ·è§£æçš„ï¼Œæˆ‘ä»¬æ”¾åœ¨ Literals.IDENTIFIER å¤„ä¸€èµ·åˆ†æã€‚</p>
<h2>3.2 Literals è¯æ³•å­—é¢é‡æ ‡è®°</h2>
<p>Literals è¯æ³•å­—é¢é‡æ ‡è®°ï¼Œä¸€å…±åˆ†æˆ 6 ç§ï¼š</p>
<ul>
<li>IDENTIFIER ï¼šè¯æ³•å…³é”®è¯</li>
<li>VARIABLE ï¼šå˜é‡</li>
<li>CHARS ï¼šå­—ç¬¦ä¸²</li>
<li>HEX ï¼šåå…­è¿›åˆ¶</li>
<li>INT ï¼šæ•´æ•°</li>
<li>FLOAT ï¼šæµ®ç‚¹æ•°</li>
</ul>
<h3>3.2.1 Literals.IDENTIFIER è¯æ³•å…³é”®è¯</h3>
<p>è¯æ³•å…³é”®è¯ã€‚ä¾‹å¦‚ï¼šè¡¨åï¼ŒæŸ¥è¯¢å­—æ®µ ç­‰ç­‰ã€‚</p>
<p>è§£æ Literals.IDENTIFIER ä¸ Keyword æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isIdentifierBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> isIdentifierBegin(getCurrentChar(<span class="number">0</span>));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isIdentifierBegin</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> CharType.isAlphabet(ch) || <span class="string">'`'</span> == ch || <span class="string">'_'</span> == ch || <span class="string">'$'</span> == ch;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«ææ ‡è¯†ç¬¦.</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> æ ‡è¯†ç¬¦æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanIdentifier</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="comment">// `å­—æ®µ`ï¼Œä¾‹å¦‚ï¼šSELECT `id` FROM t_user ä¸­çš„ `id`</span></div><div class="line">   <span class="keyword">if</span> (<span class="string">'`'</span> == charAt(offset)) &#123;</div><div class="line">       <span class="keyword">int</span> length = getLengthUntilTerminatedChar(<span class="string">'`'</span>);</div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Token(Literals.IDENTIFIER, input.substring(offset, offset + length), offset + length);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">int</span> length = <span class="number">0</span>;</div><div class="line">   <span class="keyword">while</span> (isIdentifierChar(charAt(offset + length))) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   String literals = input.substring(offset, offset + length);</div><div class="line">   <span class="comment">// å¤„ç† order / group ä½œä¸ºè¡¨å</span></div><div class="line">   <span class="keyword">if</span> (isAmbiguousIdentifier(literals)) &#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Token(processAmbiguousIdentifier(offset + length, literals), literals, offset + length);</div><div class="line">   &#125;</div><div class="line">   <span class="comment">// ä» è¯æ³•å…³é”®è¯ æŸ¥æ‰¾æ˜¯å¦æ˜¯ Keywordï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› Keywordï¼Œå¦åˆ™è¿”å› Literals.IDENTIFIER</span></div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(dictionary.findTokenType(literals, Literals.IDENTIFIER), literals, offset + length);</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">* è®¡ç®—åˆ°ç»“æŸå­—ç¬¦çš„é•¿åº¦</div><div class="line">*</div><div class="line">* <span class="doctag">@see</span> #hasEscapeChar(char, int) å¤„ç†ç±»ä¼¼ SELECT a AS `b``c` FROM tableã€‚æ­¤å¤„è¿ç»­çš„ "``" ä¸æ˜¯ç»“å°¾ï¼Œå¦‚æœä¼ é€’çš„æ˜¯ "`" ä¼šäº§ç”Ÿè¯¯åˆ¤ï¼Œæ‰€ä»¥åŠ äº†è¿™ä¸ªåˆ¤æ–­</div><div class="line">* <span class="doctag">@param</span> terminatedChar ç»“æŸå­—ç¬¦</div><div class="line">* <span class="doctag">@return</span> é•¿åº¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getLengthUntilTerminatedChar</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> terminatedChar)</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = <span class="number">1</span>;</div><div class="line">   <span class="keyword">while</span> (terminatedChar != charAt(offset + length) || hasEscapeChar(terminatedChar, offset + length)) &#123;</div><div class="line">       <span class="keyword">if</span> (offset + length &gt;= input.length()) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> UnterminatedCharException(terminatedChar);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (hasEscapeChar(terminatedChar, offset + length)) &#123;</div><div class="line">           length++;</div><div class="line">       &#125;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> length + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯ Escape å­—ç¬¦</div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> charIdentifier å­—ç¬¦</div><div class="line">* <span class="doctag">@param</span> offset ä½ç½®</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasEscapeChar</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> charIdentifier, <span class="keyword">final</span> <span class="keyword">int</span> offset)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> charIdentifier == charAt(offset) &amp;&amp; charIdentifier == charAt(offset + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isIdentifierChar</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> CharType.isAlphabet(ch) || CharType.isDigital(ch) || <span class="string">'_'</span> == ch || <span class="string">'$'</span> == ch || <span class="string">'#'</span> == ch;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯å¼•èµ·æ­§ä¹‰çš„æ ‡è¯†ç¬¦</div><div class="line">* ä¾‹å¦‚ "SELECT * FROM group"ï¼Œæ­¤æ—¶ "group" ä»£è¡¨çš„æ˜¯è¡¨åï¼Œè€Œéè¯æ³•å…³é”®è¯</div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> literals æ ‡è¯†ç¬¦</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isAmbiguousIdentifier</span><span class="params">(<span class="keyword">final</span> String literals)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> DefaultKeyword.ORDER.name().equalsIgnoreCase(literals) || DefaultKeyword.GROUP.name().equalsIgnoreCase(literals);</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">* è·å–å¼•èµ·æ­§ä¹‰çš„æ ‡è¯†ç¬¦å¯¹åº”çš„è¯æ³•æ ‡è®°ç±»å‹</div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> offset ä½ç½®</div><div class="line">* <span class="doctag">@param</span> literals æ ‡è¯†ç¬¦</div><div class="line">* <span class="doctag">@return</span> è¯æ³•æ ‡è®°ç±»å‹</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> TokenType <span class="title">processAmbiguousIdentifier</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> offset, <span class="keyword">final</span> String literals)</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">   <span class="keyword">while</span> (CharType.isWhitespace(charAt(offset + i))) &#123;</div><div class="line">       i++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">if</span> (DefaultKeyword.BY.name().equalsIgnoreCase(String.valueOf(<span class="keyword">new</span> <span class="keyword">char</span>[] &#123;charAt(offset + i), charAt(offset + i + <span class="number">1</span>)&#125;))) &#123;</div><div class="line">       <span class="keyword">return</span> dictionary.findTokenType(literals);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> Literals.IDENTIFIER;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3>3.2.2 Literals.VARIABLE å˜é‡</h3>
<p>å˜é‡ã€‚ä¾‹å¦‚ï¼š<code>SELECT @@VERSION</code> ã€‚</p>
<p>è§£ææ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯ å˜é‡</div><div class="line">* MySQL ä¸ SQL Server æ”¯æŒ</div><div class="line">* </div><div class="line">* <span class="doctag">@see</span> Tokenizer#scanVariable()</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isVariableBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«æå˜é‡.</div><div class="line">* åœ¨ MySQL é‡Œï¼Œ@ä»£è¡¨ç”¨æˆ·å˜é‡ï¼›@@ä»£è¡¨ç³»ç»Ÿå˜é‡ã€‚</div><div class="line">* åœ¨ SQLServer é‡Œï¼Œæœ‰ @@ã€‚</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> å˜é‡æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanVariable</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = <span class="number">1</span>;</div><div class="line">   <span class="keyword">if</span> (<span class="string">'@'</span> == charAt(offset + <span class="number">1</span>)) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">while</span> (isVariableChar(charAt(offset + length))) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(Literals.VARIABLE, input.substring(offset, offset + length), offset + length);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3>3.2.3 Literals.CHARS å­—ç¬¦ä¸²</h3>
<p>å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š<code>SELECT &quot;123&quot;</code> ã€‚</p>
<p>è§£ææ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦ N\</div><div class="line">* ç›®å‰ SQLServer ç‹¬æœ‰ï¼šåœ¨ SQL Server ä¸­è™•ç† Unicode å­—ä¸²å¸¸æ•¸æ™‚ï¼Œå¿…éœ€ç‚ºæ‰€æœ‰çš„ Unicode å­—ä¸²åŠ ä¸Šå‰ç½®è© N</div><div class="line">*</div><div class="line">* <span class="doctag">@see</span> Tokenizer#scanChars()</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isNCharBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> isSupportNChars() &amp;&amp; <span class="string">'N'</span> == getCurrentChar(<span class="number">0</span>) &amp;&amp; <span class="string">'\''</span> == getCurrentChar(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isCharsBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="string">'\''</span> == getCurrentChar(<span class="number">0</span>) || <span class="string">'\"'</span> == getCurrentChar(<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«æå­—ç¬¦ä¸².</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> å­—ç¬¦ä¸²æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanChars</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> scanChars(charAt(offset));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> Token <span class="title">scanChars</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> terminatedChar)</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = getLengthUntilTerminatedChar(terminatedChar);</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(Literals.CHARS, input.substring(offset + <span class="number">1</span>, offset + length - <span class="number">1</span>), offset + length);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3>3.2.4 Literals.HEX åå…­è¿›åˆ¶</h3>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯ åå…­è¿›åˆ¶</div><div class="line">*</div><div class="line">* <span class="doctag">@see</span> Tokenizer#scanHexDecimal()</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isHexDecimalBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="string">'0'</span> == getCurrentChar(<span class="number">0</span>) &amp;&amp; <span class="string">'x'</span> == getCurrentChar(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«æåå…­è¿›åˆ¶æ•°.</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> åå…­è¿›åˆ¶æ•°æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanHexDecimal</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = HEX_BEGIN_SYMBOL_LENGTH;</div><div class="line">   <span class="comment">// è´Ÿæ•°</span></div><div class="line">   <span class="keyword">if</span> (<span class="string">'-'</span> == charAt(offset + length)) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">while</span> (isHex(charAt(offset + length))) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(Literals.HEX, input.substring(offset, offset + length), offset + length);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3>3.2.5 Literals.INT æ•´æ•°</h3>
<p>æ•´æ•°ã€‚ä¾‹å¦‚ï¼š<code>SELECT * FROM t_user WHERE id = 1</code>ã€‚</p>
<p>Literals.INT ä¸ Literals.FLOAT æ˜¯ä¸€èµ·è§£æçš„ï¼Œæˆ‘ä»¬æ”¾åœ¨ Literals.FLOAT å¤„ä¸€èµ·åˆ†æã€‚</p>
<h3>3.2.6 Literals.FLOAT æµ®ç‚¹æ•°</h3>
<p>æµ®ç‚¹æ•°ã€‚ä¾‹å¦‚ï¼š<code>SELECT * FROM t_user WHERE id = 1.0</code>ã€‚
æµ®ç‚¹æ•°åŒ…å«å‡ ç§ï¼š&quot;1.0&quot;ï¼Œ&quot;1.0F&quot;ï¼Œ&quot;7.823E5&quot;ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼‰ã€‚</p>
<p>è§£ææ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯ æ•°å­—</div><div class="line">* '-' éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚".2" è¢«å¤„ç†æˆçœç•¥0çš„å°æ•°ï¼Œ"-.2" ä¸èƒ½è¢«å¤„ç†æˆçœç•¥çš„å°æ•°ï¼Œå¦åˆ™ä¼šå‡ºé—®é¢˜ã€‚</div><div class="line">* ä¾‹å¦‚è¯´ï¼Œ"SELECT a-.2" å¤„ç†çš„ç»“æœæ˜¯ "SELECT" / "a" / "-" / ".2"</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isNumberBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> CharType.isDigital(getCurrentChar(<span class="number">0</span>)) <span class="comment">// æ•°å­—</span></div><div class="line">           || (<span class="string">'.'</span> == getCurrentChar(<span class="number">0</span>) &amp;&amp; CharType.isDigital(getCurrentChar(<span class="number">1</span>)) &amp;&amp; !isIdentifierBegin(getCurrentChar(-<span class="number">1</span>)) <span class="comment">// æµ®ç‚¹æ•°</span></div><div class="line">           || (<span class="string">'-'</span> == getCurrentChar(<span class="number">0</span>) &amp;&amp; (<span class="string">'.'</span> == getCurrentChar(<span class="number">0</span>) || CharType.isDigital(getCurrentChar(<span class="number">1</span>))))); <span class="comment">// è´Ÿæ•°</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«ææ•°å­—.</div><div class="line">* è§£ææ•°å­—çš„ç»“æœä¼šæœ‰ä¸¤ç§ï¼šæ•´æ•° å’Œ æµ®ç‚¹æ•°.</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> æ•°å­—æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanNumber</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = <span class="number">0</span>;</div><div class="line">   <span class="comment">// è´Ÿæ•°</span></div><div class="line">   <span class="keyword">if</span> (<span class="string">'-'</span> == charAt(offset + length)) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">// æµ®ç‚¹æ•°</span></div><div class="line">   length += getDigitalLength(offset + length);</div><div class="line">   <span class="keyword">boolean</span> isFloat = <span class="keyword">false</span>;</div><div class="line">   <span class="keyword">if</span> (<span class="string">'.'</span> == charAt(offset + length)) &#123;</div><div class="line">       isFloat = <span class="keyword">true</span>;</div><div class="line">       length++;</div><div class="line">       length += getDigitalLength(offset + length);</div><div class="line">   &#125;</div><div class="line">   <span class="comment">// ç§‘å­¦è®¡æ•°è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šSELECT 7.823E5</span></div><div class="line">   <span class="keyword">if</span> (isScientificNotation(offset + length)) &#123;</div><div class="line">       isFloat = <span class="keyword">true</span>;</div><div class="line">       length++;</div><div class="line">       <span class="keyword">if</span> (<span class="string">'+'</span> == charAt(offset + length) || <span class="string">'-'</span> == charAt(offset + length)) &#123;</div><div class="line">           length++;</div><div class="line">       &#125;</div><div class="line">       length += getDigitalLength(offset + length);</div><div class="line">   &#125;</div><div class="line">   <span class="comment">// æµ®ç‚¹æ•°ï¼Œä¾‹å¦‚ï¼šSELECT 1.333F</span></div><div class="line">   <span class="keyword">if</span> (isBinaryNumber(offset + length)) &#123;</div><div class="line">       isFloat = <span class="keyword">true</span>;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(isFloat ? Literals.FLOAT : Literals.INT, input.substring(offset, offset + length), offset + length);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸‹ï¼š<strong>&quot;-&quot;</strong>ã€‚åœ¨æ•°å­—è¡¨è¾¾å®ä¾‹ï¼Œå¯ä»¥åˆ¤å®šä¸º è´Ÿå· å’Œ å‡å·ï¼ˆä¸è€ƒè™‘ç§‘å­¦è®¡æ•°æ³•ï¼‰ã€‚</p>
<ul>
<li>&quot;.2&quot;  è§£æç»“æœæ˜¯ &quot;.2&quot;</li>
<li>&quot;-.2&quot; è§£æç»“æœä¸èƒ½æ˜¯ &quot;-.2&quot;ï¼Œè€Œæ˜¯ &quot;-&quot; å’Œ &quot;.2&quot;ã€‚</li>
</ul>
<h2>3.3 Symbol è¯æ³•ç¬¦å·æ ‡è®°</h2>
<p>è¯æ³•ç¬¦å·æ ‡è®°ã€‚ä¾‹å¦‚ï¼š&quot;{&quot;, &quot;}&quot;, &quot;&gt;=&quot; ç­‰ç­‰ã€‚</p>
<p>è§£ææ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Lexer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ˜¯å¦æ˜¯ ç¬¦å·</div><div class="line">*</div><div class="line">* <span class="doctag">@see</span> Tokenizer#scanSymbol()</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSymbolBegin</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> CharType.isSymbol(getCurrentChar(<span class="number">0</span>));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// CharType.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* åˆ¤æ–­æ˜¯å¦ä¸ºç¬¦å·.</div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> ch å¾…åˆ¤æ–­çš„å­—ç¬¦</div><div class="line">* <span class="doctag">@return</span> æ˜¯å¦ä¸ºç¬¦å·</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSymbol</span><span class="params">(<span class="keyword">final</span> <span class="keyword">char</span> ch)</span> </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="string">'('</span> == ch || <span class="string">')'</span> == ch || <span class="string">'['</span> == ch || <span class="string">']'</span> == ch || <span class="string">'&#123;'</span> == ch || <span class="string">'&#125;'</span> == ch || <span class="string">'+'</span> == ch || <span class="string">'-'</span> == ch || <span class="string">'*'</span> == ch || <span class="string">'/'</span> == ch || <span class="string">'%'</span> == ch || <span class="string">'^'</span> == ch || <span class="string">'='</span> == ch</div><div class="line">           || <span class="string">'&gt;'</span> == ch || <span class="string">'&lt;'</span> == ch || <span class="string">'~'</span> == ch || <span class="string">'!'</span> == ch || <span class="string">'?'</span> == ch || <span class="string">'&amp;'</span> == ch || <span class="string">'|'</span> == ch || <span class="string">'.'</span> == ch || <span class="string">':'</span> == ch || <span class="string">'#'</span> == ch || <span class="string">','</span> == ch || <span class="string">';'</span> == ch;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Tokenizer.java</span></div><div class="line"><span class="comment">/**</span></div><div class="line">* æ‰«æç¬¦å·.</div><div class="line">*</div><div class="line">* <span class="doctag">@return</span> ç¬¦å·æ ‡è®°</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">public</span> Token <span class="title">scanSymbol</span><span class="params">()</span> </span>&#123;</div><div class="line">   <span class="keyword">int</span> length = <span class="number">0</span>;</div><div class="line">   <span class="keyword">while</span> (CharType.isSymbol(charAt(offset + length))) &#123;</div><div class="line">       length++;</div><div class="line">   &#125;</div><div class="line">   String literals = input.substring(offset, offset + length);</div><div class="line">   <span class="comment">// å€’åºéå†ï¼ŒæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ ç¬¦å·ã€‚ä¾‹å¦‚ literals = ";;"ï¼Œä¼šæ˜¯æ‹†åˆ†æˆä¸¤ä¸ª ";"ã€‚å¦‚æœåŸºäºæ­£åºï¼Œliterals = "&lt;="ï¼Œä¼šè¢«è§£ææˆ "&lt;" + "="ã€‚</span></div><div class="line">   Symbol symbol;</div><div class="line">   <span class="keyword">while</span> (<span class="keyword">null</span> == (symbol = Symbol.literalsOf(literals))) &#123;</div><div class="line">       literals = input.substring(offset, offset + --length);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Token(symbol, literals, offset + length);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2>3.4 Assist è¯æ³•è¾…åŠ©æ ‡è®°</h2>
<p>Assist è¯æ³•è¾…åŠ©æ ‡è®°ï¼Œä¸€å…±åˆ†æˆ 2 ç§ï¼š</p>
<ul>
<li>END ï¼šåˆ†æç»“æŸ</li>
<li>ERROR ï¼šåˆ†æé”™è¯¯ã€‚</li>
</ul>
<h1>4. å½©è›‹</h1>
<p>è€é“ï¼Œæ˜¯ä¸æ˜¯æ¯”æƒ³è±¡ä¸­ç®€å•ä¸€äº›ï¼Ÿï¼ç»§ç»­åŠ æ²¹å†™ Parser ç›¸å…³çš„æ–‡ç« ï¼æ¥ä¸€æ³¢å¾®ä¿¡å…¬ä¼—å·å…³æ³¨å§ã€‚</p>
<hr>
<p><strong>Sharding-JDBC æ­£åœ¨æ”¶é›†ä½¿ç”¨å…¬å¸åå•ï¼š<a href="https://github.com/dangdangdotcom/sharding-jdbc/issues/234" target="_blank" rel="external">ä¼ é€é—¨</a>ã€‚ğŸ™‚ ä½ çš„ç™»è®°ï¼Œä¼šè®©æ›´å¤šäººå‚ä¸å’Œä½¿ç”¨ Sharding-JDBCã€‚Sharding-JDBC ä¹Ÿä¼šå› æ­¤ï¼Œèƒ½å¤Ÿè¦†ç›–æ›´å¹¿çš„åœºæ™¯ã€‚ç™»è®°å§ï¼Œå°‘å¹´ï¼</strong></p>
<hr>
<p><strong>æˆ‘åˆ›å»ºäº†ä¸€ä¸ªå¾®ä¿¡ç¾¤ã€æºç åœˆã€‘ï¼Œå¸Œæœ›å’Œå¤§å®¶åˆ†äº«äº¤æµè¯»æºç çš„ç»éªŒã€‚<br>
è¯»æºç å…ˆéš¾åæ˜“ï¼ŒæŒæ¡æ–¹æ³•åï¼Œå¯ä»¥åšæ›´æœ‰æ·±åº¦çš„å­¦ä¹ ã€‚<br>
è€Œä¸”æŒæ¡æ–¹æ³•å¹¶ä¸éš¾å™¢ã€‚<br>
åŠ ç¾¤æ–¹å¼ï¼šå¾®ä¿¡å…¬ä¼—å·å‘é€å…³é”®å­—ã€qunã€‘ã€‚</strong></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/YunaiV">GitHub</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">2. Lexer è¯æ³•è§£æå™¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">3. Token è¯æ³•æ ‡è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 DefaultKeyword è¯æ³•å…³é”®è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Literals è¯æ³•å­—é¢é‡æ ‡è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 Literals.IDENTIFIER è¯æ³•å…³é”®è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 Literals.VARIABLE å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 Literals.CHARS å­—ç¬¦ä¸²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 Literals.HEX åå…­è¿›åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 Literals.INT æ•´æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.6.</span> <span class="toc-text">3.2.6 Literals.FLOAT æµ®ç‚¹æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Symbol è¯æ³•ç¬¦å·æ ‡è®°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 Assist è¯æ³•è¾…åŠ©æ ‡è®°</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">4. å½©è›‹</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.yunai.me/Sharding-JDBC/sql-parse-1/" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&text=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&is_video=false&description=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ&body=Check out this article: http://www.yunai.me/Sharding-JDBC/sql-parse-1/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&title=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.yunai.me/Sharding-JDBC/sql-parse-1/&name=Sharding-JDBC æºç åˆ†æ â€”â€” SQL è§£æï¼ˆä¸€ï¼‰ä¹‹è¯­æ³•è§£æ&description=" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$(" #toc-footer").toggle();return="" false;"=""><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$(" #share-footer").toggle();return="" false;"=""><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$(" #nav-footer").toggle();return="" false;"=""><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 ç‹æ–‡æ–Œ
  </div>

  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/YunaiV">GitHub</a></li>
        
          <li>
              Hosted by <a href="https://pages.coding.me" style="font-weight: bold" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a>
          </li>
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

<!-- Disqus Comments -->


<!--page counter part-->
<script>
    function addCount(Counter) {
        // TODO å¾…ä¼˜åŒ–ï¼šè¿‡æ»¤ çˆ¬è™«
        url = $('#actions .icon').attr('href').trim(); // æ–‡ç« url
//        alert(url);
        title = $('.posttitle').text().trim(); // æ–‡ç« æ ‡é¢˜
        var query = new AV.Query(Counter);
        //use url as unique idnetfication
        query.equalTo("url", url);
        query.find({
            success: function (results) {
                if (results.length > 0) {
                    var counter = results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                    // æ’å…¥æ¬¡æ•°
                    $('.postdate').append('&nbsp;' + (counter.get('time') + 1) + '  Views');
                } else {
                    var newcounter = new Counter();
                    newcounter.set("title", title);
                    newcounter.set("url", url);
                    newcounter.set("time", 1);
                    newcounter.save(null, {
                        success: function (newcounter) {
                            // æ’å…¥æ¬¡æ•°
                            $('.postdate').append('&nbsp;1  Views');
                        },
                        error: function (newcounter, error) {
                        }
                    });
                }
            },
            error: function (error) {
            }
        });
    }

    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=")
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1
                c_end = document.cookie.indexOf(";", c_start)
                if (c_end == -1) c_end = document.cookie.length
                return unescape(document.cookie.substring(c_start, c_end))
            }
        }
        return ""
    }

    function setCookie(c_name, value, expiredays) {
        var exdate = new Date()
        exdate.setDate(exdate.getDate() + expiredays)
        document.cookie = c_name + "=" + escape(value) +
            ((expiredays == null) ? "" : ";expires=" + exdate.toGMTString())
    }

    function addVisitLog() {
        // è·å–uid
        var visitorId = getCookie('blog_visitor_id');
        if (visitorId.length != 36) {
            visitorId = uuid();
            setCookie('blog_visitor_id', visitorId);
        }
        // ip æµè§ˆå™¨æ— æ³•è·å–
        // time æœåŠ¡ç«¯å·²ç»è®°å½•
        var url = location.href;
        var ua = navigator.userAgent;
        var referer = document.referrer;
        var Log = AV.Object.extend("VisitLog");
        var log = new Log();
        log.set('url', url);
        log.set('ua', ua);
        log.set('referer', referer);
        log.set('visitorId', visitorId);
        log.save();
    }

    function uuid() {
        var s = [];
        var hexDigits = "0123456789abcdef";
        for (var i = 0; i < 36; i++) {
            s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
        }
        s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
        s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
        s[8] = s[13] = s[18] = s[23] = "-";

        var uuid = s.join("");
        return uuid;
    }

    // TODO å¾…ä¼˜åŒ–ï¼šæ­¤å¤„æ€§èƒ½è¾ƒå·®ï¼Œå¯èƒ½
    function countVisitLog() {
        var Log = AV.Object.extend("VisitLog");
        var query = new AV.Query(Log);
        query.count({
            success: function (results) {
                $('.footer-left').append('&nbsp;' + results + '  Views');
            },
            error: function (error) {
            }
        });
    }

    $(function () {
        // åˆ¤æ–­æ˜¯å¦åœ¨æ–‡ç« é¡µ
        setTimeout(function () {
            if ($('.posttitle').length == 1) {
                var Counter = AV.Object.extend("Counter");
                // å¢åŠ æ–‡ç« è®¿é—®æ¬¡æ•°
                addCount(Counter);
            }
            // è®°å½•è®¿é—®æ—¥å¿—
            addVisitLog();
            // è®¡ç®—å¤šå°‘äººè®¿é—®
            countVisitLog();
        }, 1000);
    });
</script>
